<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Dashboard | Golden Games</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --gold: #f0b90b; --bg: #0b0e11; --card-bg: #1e2329; --text-gray: #848e9c; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); color: white; padding: 15px; min-height: 100vh; }
        .container { max-width: 480px; margin: auto; }
        
        h2 { color: var(--gold); text-align: center; margin-top: 15px; font-weight: 800; text-transform: uppercase; }
        .subtitle { text-align: center; color: var(--text-gray); font-size: 13px; margin-bottom: 25px; }

        /* Earnings Card */
        .live-card {
            background: linear-gradient(135deg, #1e2329 0%, #2b3139 100%);
            border-radius: 25px; padding: 35px 20px; border: 1px solid #333;
            text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            margin-bottom: 20px; position: relative;
        }
        .live-label { font-size: 11px; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; display: block; }
        .live-amount { font-size: 42px; font-weight: 800; color: #fff; font-family: 'Courier New', Courier, monospace; }
        
        .live-stats { display: flex; justify-content: space-around; margin-top: 25px; border-top: 1px solid #333; padding-top: 20px; }
        .stat-item p { margin: 0; font-size: 12px; color: var(--text-gray); }
        .stat-item span { font-size: 20px; font-weight: bold; color: var(--gold); }

        /* Link Box */
        .link-section { background: var(--card-bg); border-radius: 20px; padding: 20px; border: 1px solid #333; margin-bottom: 25px; }
        .link-label { font-size: 14px; color: var(--text-gray); margin-bottom: 12px; display: block; text-align: center; }
        .link-box { 
            background: #000; border: 1px dashed var(--gold); padding: 15px; border-radius: 12px; 
            color: var(--gold); font-size: 12px; word-break: break-all; cursor: pointer; text-align: center;
            transition: 0.3s;
        }
        .link-box:active { transform: scale(0.98); background: #111; }

        /* Buttons */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .btn { border: none; padding: 16px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 14px; text-transform: uppercase; }
        .btn-wa { background: #25D366; color: white; }
        .btn-copy { background: var(--gold); color: black; }
        .btn:active { transform: scale(0.95); }

        /* Guide Section */
        .guide { background: rgba(255, 215, 0, 0.05); border-radius: 15px; padding: 20px; margin-top: 20px; border: 1px solid rgba(255, 215, 0, 0.1); }
        .guide h4 { color: var(--gold); margin-bottom: 10px; font-size: 15px; }
        .guide p { font-size: 12px; color: #ccc; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h2>Partner Dashboard</h2>
    <p class="subtitle">Get 50% commission of your referral's profit</p>

    <div class="live-card">
        <span class="live-label">‚óè Live Affiliate Earnings ($)</span>
        <div class="live-amount" id="liveProfit">0.00000</div>
        
        <div class="live-stats">
            <div class="stat-item">
                <p>Referrals</p>
                <span id="totalRefs">0</span>
            </div>
            <div class="stat-item">
                <p>Your Share</p>
                <span>50%</span>
            </div>
        </div>
    </div>

    <div class="link-section">
        <span class="link-label">Tap box to copy your link</span>
        <div class="link-box" id="refLink" onclick="copyLink()">Generating Link...</div>
        
        <div class="btn-grid">
            <button class="btn btn-copy" onclick="copyLink()">Copy URL</button>
            <button class="btn btn-wa" onclick="shareWhatsApp()">WhatsApp</button>
        </div>
    </div>

    <div class="guide">
        <h4>üí° How it works?</h4>
        <p>When your friends join using your link and earn profit through our AI trading, you automatically receive <b>50%</b> of their profit share. Earnings are updated in real-time and added to your wallet.</p>
    </div>
</div>

<script>
    // --- Firebase Configuration (Fully Integrated) ---
    const firebaseConfig = {
        apiKey: "AIzaSyDz_mp5wpULG732DXhZDoVczdy369j8WBY",
        authDomain: "ludo-joy-fb32d.firebaseapp.com",
        databaseURL: "https://ludo-joy-fb32d-default-rtdb.firebaseio.com",
        projectId: "ludo-joy-fb32d",
        storageBucket: "ludo-joy-fb32d.firebasestorage.app",
        messagingSenderId: "128560388256",
        appId: "1:128560388256:web:a8b945a3658160277391c5"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged((user) => {
        if (user) {
            const myUID = user.uid;
            
            // Link Generation (Points to index.html for signup)
            const myLink = window.location.origin + "/index.html?ref=" + myUID;
            document.getElementById('refLink').innerText = myLink;

            // --- Real-Time Referral & Profit Calculation ---
            // 'referredBy' field is used to find your friends
            db.ref('users').orderByChild('referredBy').equalTo(myUID).on('value', (snapshot) => {
                let count = 0;
                let totalCommission = 0;

                snapshot.forEach((child) => {
                    count++;
                    // Referral ka 'totalProfit' field check ho raha hai
                    let friendProfit = parseFloat(child.val().totalProfit) || 0;
                    totalCommission += (friendProfit * 0.50); // 50% Commission logic
                });

                // UI Update with 0.00000 format
                document.getElementById('totalRefs').innerText = count;
                document.getElementById('liveProfit').innerText = totalCommission.toFixed(5);
                
                // Final Step: Auto-update user's database record
                db.ref('users/' + myUID).update({
                    referralEarning: totalCommission.toFixed(5)
                });
            });
        } else {
            // If not logged in, send to login page
            window.location.href = "index.html";
        }
    });

    // --- Utility Functions ---
    function copyLink() {
        const link = document.getElementById('refLink').innerText;
        navigator.clipboard.writeText(link).then(() => {
            alert("‚úÖ Link copied! Share it to start earning.");
        });
    }

    function shareWhatsApp() {
        const link = document.getElementById('refLink').innerText;
        const text = encodeURIComponent("üöÄ Join Golden Games! Invest and earn 3% daily. Register here: " + link);
        window.open("https://api.whatsapp.com/send?text=" + text, "_blank");
    }
</script>

</body>
</html>
