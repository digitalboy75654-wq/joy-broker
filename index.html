<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>joy Broker - Verified Version</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body {
            height: 100vh; display: flex; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1611996575749-79a3a250f948?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 30px;
            padding: 40px 30px; width: 380px; text-align: center; color: white;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        h2 { font-size: 28px; font-weight: 800; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 2px; }

        .guide-bar {
            background: #ffffff; color: #1e272e; padding: 20px; border-radius: 15px;
            margin-bottom: 20px; display: none; text-align: center; border-bottom: 5px solid #2ecc71;
            animation: slideDown 0.5s ease forwards;
        }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .guide-bar h3 { color: #2ecc71; margin-bottom: 5px; font-weight: 800; }
        .guide-bar p { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 15px; }

        .input-box { width: 100%; margin-bottom: 15px; position: relative; }
        input {
            width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 12px;
            color: white; font-size: 16px; outline: none; transition: 0.3s;
        }
        input:focus { background: rgba(255, 255, 255, 0.25); border-color: #fff; }
        input::placeholder { color: #ffffff !important; opacity: 0.8; }

        .btn {
            width: 100%; padding: 15px; background: #fff; color: #e73c7e;
            border: none; border-radius: 35px; font-size: 18px; font-weight: 800; cursor: pointer;
            margin-top: 10px; transition: 0.3s;
        }
        .btn:active { transform: scale(0.95); }

        .error-text { color: #ff4d4d; font-size: 12px; margin-top: 5px; font-weight: 700; display: none; text-align: left; }
        .link { cursor: pointer; font-size: 13px; opacity: 0.9; margin-top: 15px; display: inline-block; font-weight: 600; text-decoration: underline; }
        
        #signup-screen, #reset-screen { display: none; }
    </style>
</head>
<body>

    <div id="login-screen" class="glass-card">
        <h2>Joy Broker</h2>
        <div class="input-box"><input type="email" id="l-email" placeholder="Email ID"></div>
        <div class="input-box">
            <input type="password" id="l-pass" placeholder="Password">
            <div id="l-err" class="error-text"></div>
        </div>
        <button class="btn" onclick="login()">LOGIN</button>
        <div style="display: flex; justify-content: space-between;">
            <span class="link" onclick="showScreen('reset-screen')">Forget Password?</span>
            <span class="link" onclick="showScreen('signup-screen')">Register Account</span>
        </div>
    </div>

    <div id="signup-screen" class="glass-card">
        <h2>SIGN UP</h2>
        <div id="signup-guide" class="guide-bar">
            <h3>SUCCESS! ðŸŽ‰</h3>
            <p>Verification link sent! Please check your email (or spame folser) and verify to continue.</p>
            <button class="btn" style="background: #e73c7e; color: white; font-size: 14px; padding: 10px;" onclick="showScreen('login-screen')">GO TO LOGIN</button>
        </div>
        <div id="signup-fields">
            <div class="input-box"><input type="text" id="s-user" placeholder="Username"></div>
            <div class="input-box"><input type="email" id="s-email" placeholder="Email Address"></div>
            <div class="input-box">
                <input type="password" id="s-pass" placeholder="Password">
                <div id="s-err" class="error-text"></div>
            </div>
            <button class="btn" id="signup-btn" onclick="signup()">CREATE ACCOUNT</button>
        </div>
        <p class="link" onclick="showScreen('login-screen')">Back to Login</p>
    </div>

    <div id="reset-screen" class="glass-card">
        <h2>RESET</h2>
        <div id="reset-guide" class="guide-bar">
            <h3>LINK SENT! ðŸ“§</h3>
            <p>Password reset link has been sent. Check your email.</p>
            <button class="btn" style="background: #e73c7e; color: white; font-size: 14px; padding: 10px;" onclick="showScreen('login-screen')">BACK TO LOGIN</button>
        </div>
        <div id="reset-fields">
            <p style="font-size: 13px; margin-bottom: 15px;">Enter email to receive reset link.</p>
            <div class="input-box">
                <input type="email" id="r-email" placeholder="Registered Email">
                <div id="r-err" class="error-text"></div>
            </div>
            <button class="btn" id="reset-btn" onclick="resetPassword()">SEND LINK</button>
        </div>
        <p class="link" onclick="showScreen('login-screen')">Cancel</p>
    </div>

    <script>

		// 1. URL se Referral ID pakarna
const urlParams = new URLSearchParams(window.location.search);
const refID = urlParams.get('ref');

// 2. Register function mein save karna
function handleSignUp() {
    // Aapka baki signup code...
    
    const userData = {
        email: emailInput.value,
        referredBy: refID || "direct", // Agar link se aaya to ID, warna "direct"
        dailyProfit: 0,
        balance: 0
    };
    
    firebase.database().ref('users/' + userUID).set(userData);
}
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDz_mp5wpULG732DXhZDoVczdy369j8WBY",
            authDomain: "ludo-joy-fb32d.firebaseapp.com",
            databaseURL: "https://ludo-joy-fb32d-default-rtdb.firebaseio.com",
            projectId: "ludo-joy-fb32d",
            storageBucket: "ludo-joy-fb32d.firebasestorage.app",
            messagingSenderId: "128560388256",
            appId: "1:128560388256:web:a8b945a3658160277391c5"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        function showScreen(id) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('signup-screen').style.display = 'none';
            document.getElementById('reset-screen').style.display = 'none';
            document.getElementById(id).style.display = 'block';

            // Resetting UI elements
            document.getElementById('signup-guide').style.display = 'none';
            document.getElementById('signup-fields').style.display = 'block';
            document.getElementById('reset-guide').style.display = 'none';
            document.getElementById('reset-fields').style.display = 'block';
            document.querySelectorAll('.error-text').forEach(e => e.style.display = 'none');
        }

        // --- SIGNUP LOGIC WITH POPUP FIX ---
        function signup() {
            const email = document.getElementById('s-email').value;
            const pass = document.getElementById('s-pass').value;
            const user = document.getElementById('s-user').value;
            const err = document.getElementById('s-err');
            const btn = document.getElementById('signup-btn');

            if(!email || !pass || !user) {
                err.innerText = "All fields are required!";
                err.style.display = "block";
                return;
            }

            btn.disabled = true;
            btn.innerText = "PROCESSING...";

            auth.createUserWithEmailAndPassword(email, pass).then((res) => {
                res.user.sendEmailVerification();
                
                // Saving to Realtime Database
                db.ref('users/' + res.user.uid).set({
                    username: user,
                    email: email,
                    wallet: 0,
                    totalDeposit: 0,
                    totalProfit: 0,
                    totalLoss: 0,
                    isBlocked: false,
                    joinedAt: Date.now()
                }).then(() => {
                    // SHOW POPUP HERE
                    document.getElementById('signup-fields').style.display = 'none';
                    document.getElementById('signup-guide').style.display = 'block';
                });

            }).catch(e => {
                btn.disabled = false;
                btn.innerText = "CREATE ACCOUNT";
                err.innerText = e.message;
                err.style.display = "block";
            });
        }

        // --- RESET LOGIC WITH POPUP FIX ---
        function resetPassword() {
            const email = document.getElementById('r-email').value;
            const err = document.getElementById('r-err');
            const btn = document.getElementById('reset-btn');

            if(!email) {
                err.innerText = "Please enter email!";
                err.style.display = "block";
                return;
            }

            btn.disabled = true;

            auth.sendPasswordResetEmail(email).then(() => {
                // SHOW POPUP HERE
                document.getElementById('reset-fields').style.display = 'none';
                document.getElementById('reset-guide').style.display = 'block';
            }).catch(e => {
                btn.disabled = false;
                err.innerText = e.message;
                err.style.display = "block";
            });
        }

        // --- LOGIN LOGIC ---
        function login() {
            const email = document.getElementById('l-email').value;
            const pass = document.getElementById('l-pass').value;
            const errDiv = document.getElementById('l-err');

            auth.signInWithEmailAndPassword(email, pass).then((res) => {
                if(res.user.emailVerified) {
                    window.location.href = "home.html";
                } else {
                    errDiv.innerText = "Please verify your email link first!";
                    errDiv.style.display = 'block';
                }
            }).catch(e => {
                errDiv.innerText = "Invalid Email or Password!";
                errDiv.style.display = 'block';
            });
        }
    </script>
</body>

</html>

