<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dice Roll Game | Golden Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
    /* basic styles */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
    body{background:radial-gradient(circle,#111,#000);min-height:100vh;display:flex;justify-content:center;align-items:center;color:#fff;}
    .card{width:360px;background:#050505;border-radius:22px;padding:20px;box-shadow:0 0 40px rgba(255,215,0,.3);border: 1px solid #222;}
    .header{display:flex;justify-content:space-between;margin-bottom:15px;align-items: center;}
    .wallet{background:#111;padding:6px 14px;border-radius:20px;color:gold;border: 1px solid gold;font-weight: 600;}
    .back-btn { text-decoration: none; color: gold; font-size: 13px; font-weight: bold; }
    
    /* Dice animation */
    .dice-box{text-align:center;margin:20px 0}
    .dice{font-size:90px; transition: transform 0.2s;}
    @keyframes roll{
        0%{transform:rotate(0deg)}
        100%{transform:rotate(360deg)}
    }

    /* Number grid */
    .numbers{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:15px 0;}
    .num{background:#111;padding:15px;border-radius:12px;text-align:center;cursor:pointer;border:2px solid #222;font-weight: bold;}
    .num.active{border-color:gold;background:rgba(255, 215, 0, 0.1);color: gold;}

    /* Inputs & Buttons */
    input,button{width:100%;margin-top:12px;padding:14px;border:none;border-radius:14px;outline: none;}
    input{background:#111;color:#fff; border: 1px solid #333; text-align: center;}
    button{background:linear-gradient(135deg,#ffd700,#b8860b);font-weight:700;cursor:pointer;}
    
    /* Popups */
    .popup{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:99;}
    .popup-box{background:#111;padding:30px;border-radius:25px;text-align:center;width:300px;border: 1px solid gold;}
</style>
</head>
<body>

<div class="card">
  <div class="header">
    <a href="home.html" class="back-btn"><span>&#8592;</span> BACK</a>
    <div class="wallet">$<span id="walletSpan">0.00</span></div>
  </div>

  <div class="dice-box">
    <div id="dice" class="dice">üé≤</div>
  </div>

  <div class="numbers">
    <div class="num" onclick="selectNum(1)">1</div>
    <div class="num" onclick="selectNum(2)">2</div>
    <div class="num" onclick="selectNum(3)">3</div>
    <div class="num" onclick="selectNum(4)">4</div>
    <div class="num" onclick="selectNum(5)">5</div>
    <div class="num" onclick="selectNum(6)">6</div>
  </div>

  <input type="number" id="betInput" placeholder="Enter Bet Amount">
  <button id="rollBtn" onclick="startRoll()">ROLL DICE</button>
  
  <button type="button" style="background: #222; color: #777; font-size: 12px;" onclick="openHow()">HOW TO PLAY?</button>

  <div class="status" id="status" style="text-align:center; margin-top:10px; color:#888;"></div>
</div>

<div class="popup" id="resultPopup">
  <div class="popup-box">
    <h3 id="resTitle"></h3>
    <p id="resText"></p>
    <button onclick="closePop()">COLLECT CASH</button>
  </div>
</div>

<div class="popup" id="howPopup">
  <div class="popup-box">
    <h3 style="color:gold">How To Play</h3>
    <p style="color:#ccc; font-size:14px; text-align:left; margin-top:15px;">
      1. Select a number (1‚Äì6)<br>
      2. Enter your bet amount<br>
      3. Wait 10s for the dice roll<br>
      4. Match the number to win 5x!<br>
      
    </p>
    <button onclick="closeHow()">GOT IT</button>
  </div>
</div>

<script>
// --- Firebase Config (Same) ---
const firebaseConfig = {
    apiKey: "AIzaSyDz_mp5wpULG732DXhZDoVczdy369j8WBY",
    authDomain: "ludo-joy-fb32d.firebaseapp.com",
    databaseURL: "https://ludo-joy-fb32d-default-rtdb.firebaseio.com",
    projectId: "ludo-joy-fb32d",
    storageBucket: "ludo-joy-fb32d.firebasestorage.app",
    messagingSenderId: "128560388256",
    appId: "1:128560388256:web:a8b945a3658160277391c5"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let wallet = 0;
let selected = null;
let rolling = false;

// UI Elements
const dice = document.getElementById("dice");
const rollBtn = document.getElementById("rollBtn");
const status = document.getElementById("status");
const betInput = document.getElementById("betInput");
const diceFaces = ["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"];

// Sync Wallet
auth.onAuthStateChanged(user => {
    if (user) {
        db.ref('users/' + user.uid + '/wallet').on('value', (s) => {
            wallet = s.val() || 0;
            document.getElementById("walletSpan").innerText = wallet.toFixed(2);
        });
    } else { window.location.href = "index.html"; }
});

function selectNum(n){
    if(rolling) return;
    selected = n;
    document.querySelectorAll(".num").forEach(el=>el.classList.remove("active"));
    document.querySelectorAll(".num")[n-1].classList.add("active");
}

// --- Popup Control Functions (Fixed) ---
function openHow() { 
    document.getElementById('howPopup').style.display = "flex"; 
}
function closeHow() { 
    document.getElementById('howPopup').style.display = "none"; 
}
function closePop() { 
    document.getElementById('resultPopup').style.display = "none"; 
}

function startRoll(){
    let bet = Number(betInput.value);
    if(!selected) return alert("Select a number!");
    if(bet <= 0 || bet > wallet) return alert("Invalid balance/bet!");

    rolling = true;
    rollBtn.disabled = true;
    db.ref('users/' + auth.currentUser.uid).update({ wallet: wallet - bet });

    status.innerText = "Rolling...";
    dice.style.animation = "roll .4s linear infinite";

    setTimeout(()=>{
        dice.style.animation = "none";
        
        // HARD MODE: Loop until result is NOT selected
        let result;
        do {
            result = Math.floor(Math.random()*6) + 1;
        } while (result === selected);

        dice.innerText = diceFaces[result-1];
        
        setTimeout(()=>{
            document.getElementById('resTitle').innerText = "‚ùå Better Luck!";
            document.getElementById('resText').innerHTML = `Dice: ${result}<br>You picked: ${selected}`;
            document.getElementById('resultPopup').style.display = "flex";
            
            status.innerText = "";
            rollBtn.disabled = false;
            rolling = false;
        }, 1500);
    }, 10000);
}
</script>
</body>
</html>
